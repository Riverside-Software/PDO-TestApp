 /*------------------------------------------------------------------------
    File        : NewColumnDialog
    Purpose     : 
    Syntax      : 
    Description : 
    Author(s)   : hdaniels
    Created     : Tue May 27 20:11:29 EDT 2008
    Notes       : 
  ----------------------------------------------------------------------*/
USING Progress.Windows.Form.
  
CLASS WinGrid.SamplesExplorer.NewColumnDialog INHERITS Form   : 
    
    define public property Band as Infragistics.Win.UltraWinGrid.UltraGridBand no-undo
    get.
    set. 
    
    define public property CreatedColumn as Infragistics.Win.UltraWinGrid.UltraGridColumn no-undo
    get.
    private set. 
    
	DEFINE PRIVATE VARIABLE components AS System.ComponentModel.IContainer NO-UNDO.

    define private variable ultraLabelFormula as Infragistics.Win.Misc.UltraLabel no-undo.
    define private variable ultraTextEditorFormula as Infragistics.Win.UltraWinEditors.UltraTextEditor no-undo.
    define private variable ultraButtonCancel as Infragistics.Win.Misc.UltraButton no-undo.
    define private variable ultraButtonOk as Infragistics.Win.Misc.UltraButton no-undo.
    define private variable ultraComboEditorType as Infragistics.Win.UltraWinEditors.UltraComboEditor no-undo.
    define private variable ultraLabel2 as Infragistics.Win.Misc.UltraLabel no-undo.
    define private variable ultraLabel1 as Infragistics.Win.Misc.UltraLabel no-undo.
    define private variable ultraTextEditorName as Infragistics.Win.UltraWinEditors.UltraTextEditor no-undo.
	
	CONSTRUCTOR PUBLIC NewColumnDialog( ):
		SUPER().
		InitializeComponent ( ).

	END CONSTRUCTOR.

	DESTRUCTOR PUBLIC NewColumnDialog( ):

		IF VALID-OBJECT(components) THEN DO:
			CAST(components, System.IDisposable):Dispose().
		END.

	END DESTRUCTOR.	

    METHOD PRIVATE VOID okButton_Click (sender AS System.Object, e AS System.EventArgs):
		THIS-OBJECT:DialogResult = System.Windows.Forms.DialogResult:Ok.
		THIS-OBJECT:Close ( ). 
	END METHOD.

	METHOD PRIVATE VOID cancelButton_Click (sender AS System.Object, e AS System.EventArgs):
		THIS-OBJECT:DialogResult = System.Windows.Forms.DialogResult:Cancel.
		THIS-OBJECT:Close ( ).
	END METHOD.

	method private void InitializeComponent ( ):

/* 		NOTE: The following method is generated by the OpenEdge Advanced GUI Visual Designer.

		We strongly suggest that the contents of this method only be modified using the
		Visual Designer to avoid any incompatible modifications.

		Modifying the contents of this method using a code editor will invalidate any support for this file. */

		@VisualDesigner.FormMember (NeedsInitialize="true").
		define variable editorButton1 as Infragistics.Win.UltraWinEditors.EditorButton no-undo.
		editorButton1 = new Infragistics.Win.UltraWinEditors.EditorButton().
		@VisualDesigner.FormMember (NeedsInitialize="true").
		define variable appearance1 as Infragistics.Win.Appearance no-undo.
		appearance1 = new Infragistics.Win.Appearance().
		this-object:ultraLabelFormula = new Infragistics.Win.Misc.UltraLabel().
		this-object:ultraTextEditorFormula = new Infragistics.Win.UltraWinEditors.UltraTextEditor().
		this-object:ultraButtonCancel = new Infragistics.Win.Misc.UltraButton().
		this-object:ultraButtonOk = new Infragistics.Win.Misc.UltraButton().
		this-object:ultraComboEditorType = new Infragistics.Win.UltraWinEditors.UltraComboEditor().
		this-object:ultraLabel2 = new Infragistics.Win.Misc.UltraLabel().
		this-object:ultraLabel1 = new Infragistics.Win.Misc.UltraLabel().
		this-object:ultraTextEditorName = new Infragistics.Win.UltraWinEditors.UltraTextEditor().
		cast(this-object:ultraTextEditorFormula, System.ComponentModel.ISupportInitialize):BeginInit().
		cast(this-object:ultraComboEditorType, System.ComponentModel.ISupportInitialize):BeginInit().
		cast(this-object:ultraTextEditorName, System.ComponentModel.ISupportInitialize):BeginInit().
		this-object:SuspendLayout().
		/*  */
		/* ultraLabelFormula */
		/*  */
		this-object:ultraLabelFormula:Location = new System.Drawing.Point(9, 57).
		this-object:ultraLabelFormula:Name = "ultraLabelFormula".
		this-object:ultraLabelFormula:Size = new System.Drawing.Size(100, 23).
		this-object:ultraLabelFormula:TabIndex = 15.
		this-object:ultraLabelFormula:Text = "Formula (optional)".
		/*  */
		/* ultraTextEditorFormula */
		/*  */
		appearance1:FontData:BoldAsString = "True".
		appearance1:TextHAlignAsString = "Center".
		appearance1:TextVAlignAsString = "Middle".
		editorButton1:Appearance = appearance1.
		editorButton1:ButtonStyle = Infragistics.Win.UIElementButtonStyle:Button.
		editorButton1:Text = "...".
		this-object:ultraTextEditorFormula:ButtonsRight:Add(editorButton1).
		this-object:ultraTextEditorFormula:Location = new System.Drawing.Point(113, 57).
		this-object:ultraTextEditorFormula:Name = "ultraTextEditorFormula".
		this-object:ultraTextEditorFormula:Size = new System.Drawing.Size(144, 21).
		this-object:ultraTextEditorFormula:TabIndex = 14.
		this-object:ultraTextEditorFormula:EditorButtonClick:subscribe(this-object:ultraTextEditorFormula_EditorButtonClick).
		/*  */
		/* ultraButtonCancel */
		/*  */
		this-object:ultraButtonCancel:DialogResult = System.Windows.Forms.DialogResult:Cancel.
		this-object:ultraButtonCancel:Location = new System.Drawing.Point(137, 89).
		this-object:ultraButtonCancel:Name = "ultraButtonCancel".
		this-object:ultraButtonCancel:Size = new System.Drawing.Size(75, 23).
		this-object:ultraButtonCancel:TabIndex = 13.
		this-object:ultraButtonCancel:Text = "&Cancel".
		this-object:ultraButtonCancel:Click:subscribe(this-object:ultraButtonCancel_Click).
		/*  */
		/* ultraButtonOk */
		/*  */
		this-object:ultraButtonOk:Location = new System.Drawing.Point(49, 89).
		this-object:ultraButtonOk:Name = "ultraButtonOk".
		this-object:ultraButtonOk:Size = new System.Drawing.Size(75, 23).
		this-object:ultraButtonOk:TabIndex = 12.
		this-object:ultraButtonOk:Text = "&Ok".
		this-object:ultraButtonOk:Click:subscribe(this-object:ultraButtonOk_Click).
		/*  */
		/* ultraComboEditorType */
		/*  */
		this-object:ultraComboEditorType:DropDownStyle = Infragistics.Win.DropDownStyle:DropDownList.
		this-object:ultraComboEditorType:Location = new System.Drawing.Point(113, 33).
		this-object:ultraComboEditorType:Name = "ultraComboEditorType".
		this-object:ultraComboEditorType:Size = new System.Drawing.Size(144, 21).
		this-object:ultraComboEditorType:SyncWithCurrencyManager = false.
		this-object:ultraComboEditorType:TabIndex = 11.
		/*  */
		/* ultraLabel2 */
		/*  */
		this-object:ultraLabel2:Location = new System.Drawing.Point(9, 33).
		this-object:ultraLabel2:Name = "ultraLabel2".
		this-object:ultraLabel2:Size = new System.Drawing.Size(100, 23).
		this-object:ultraLabel2:TabIndex = 10.
		this-object:ultraLabel2:Text = "Type".
		/*  */
		/* ultraLabel1 */
		/*  */
		this-object:ultraLabel1:Location = new System.Drawing.Point(9, 9).
		this-object:ultraLabel1:Name = "ultraLabel1".
		this-object:ultraLabel1:Size = new System.Drawing.Size(100, 23).
		this-object:ultraLabel1:TabIndex = 9.
		this-object:ultraLabel1:Text = "Name".
		/*  */
		/* ultraTextEditorName */
		/*  */
		this-object:ultraTextEditorName:Location = new System.Drawing.Point(113, 9).
		this-object:ultraTextEditorName:Name = "ultraTextEditorName".
		this-object:ultraTextEditorName:Size = new System.Drawing.Size(144, 21).
		this-object:ultraTextEditorName:TabIndex = 8.
		/*  */
		/* NewColumnDialog */
		/*  */
		this-object:ClientSize = new System.Drawing.Size(266, 120).
		this-object:Controls:Add(this-object:ultraLabelFormula).
		this-object:Controls:Add(this-object:ultraTextEditorFormula).
		this-object:Controls:Add(this-object:ultraButtonCancel).
		this-object:Controls:Add(this-object:ultraButtonOk).
		this-object:Controls:Add(this-object:ultraComboEditorType).
		this-object:Controls:Add(this-object:ultraLabel2).
		this-object:Controls:Add(this-object:ultraLabel1).
		this-object:Controls:Add(this-object:ultraTextEditorName).
		this-object:FormBorderStyle = System.Windows.Forms.FormBorderStyle:FixedDialog.
		this-object:MaximizeBox = false.
		this-object:MinimizeBox = false.
		this-object:Name = "NewColumnDialog".
		this-object:ShowInTaskbar = false.
		this-object:StartPosition = System.Windows.Forms.FormStartPosition:CenterParent.
		this-object:Text = "New Column".
		this-object:Load:subscribe(this-object:NewColumnDialog_Load).
		cast(this-object:ultraTextEditorFormula, System.ComponentModel.ISupportInitialize):EndInit().
		cast(this-object:ultraComboEditorType, System.ComponentModel.ISupportInitialize):EndInit().
		cast(this-object:ultraTextEditorName, System.ComponentModel.ISupportInitialize):EndInit().
		this-object:ResumeLayout(false).
		this-object:PerformLayout().

	end method.

	
	METHOD PUBLIC VOID ShowModalDialog(  ):
		
		WAIT-FOR THIS-OBJECT:ShowDialog().

	END METHOD.

    /* Creates the column based on currently input data. If a column was previously created
	   then reuses that. */
	method private logical CreateColumnHelper( ):
        define variable columnName as character no-undo.
        define variable typeItem as Infragistics.Win.ValueListItem no-undo.
		
		columnName = trim(ultraTextEditorName:Text).
		/* Don't allow empty string as the column name. */
		if columnName = ?  or columnName = "" then
		do:
			System.Windows.Forms.MessageBox:Show(this-object, 
			                                     "Please enter a column name.", 
			                                     this-object:Text, 
			                                     System.Windows.Forms.MessageBoxButtons:OK, 
			                                     System.Windows.Forms.MessageBoxIcon:Information ).
			return false.
		end.

		/* Make sure that a column by the same name doesn't exist already. */
		if this-object:Band:Columns:Exists( columnName ) 
        and (not valid-object(CreatedColumn) or CreatedColumn:Key <> columnName ) then
        do:
		    /* 
			&& ( null == this.createdColumn || this.createdColumn.Key != columnName ) )
		     */
		    System.Windows.Forms.MessageBox:Show(this-object, 
		                                         "A column by this name already exists. Please enter a different name.", 
			                                     this-object:Text, 
			                                     System.Windows.Forms.MessageBoxButtons:OK, 
			                                     System.Windows.Forms.MessageBoxIcon:Information ).
		 
			return false.		
		end.
		
		typeItem  = ultraComboEditorType:SelectedItem.
		if not valid-object(typeItem) then
		do:
		    System.Windows.Forms.MessageBox:Show(this-object, 
		                                         "Please select the type of column you want to add.", 
			                                     this-object:Text, 
			                                     System.Windows.Forms.MessageBoxButtons:OK, 
			                                     System.Windows.Forms.MessageBoxIcon:Information ).
		 
			return false.	
		end.
		/* If we haven't already created the column then create one. */
		if not valid-object(CreatedColumn) then
        do:
            CreatedColumn = this-object:Band:Columns:Add(columnName).
        end.
        else 
            CreatedColumn:Key = columnName.
		
		/* Assign the newly selected data tyle and formula if any. */
		CreatedColumn:DataType = cast(typeItem:DataValue,System.Type).
		CreatedColumn:Formula =  ultraTextEditorFormula:Text.
        
		return true.
	end method.
    
    
    method private void LoadTypesCombo( ):
		
		ultraComboEditorType:Items:Clear( ). 
		ultraComboEditorType:Items:Add(Progress.Util.TypeHelper:GetType("System.String"),"Text").
		ultraComboEditorType:Items:Add(Progress.Util.TypeHelper:GetType("System.Boolean"),"Checkbox").
		ultraComboEditorType:Items:Add(Progress.Util.TypeHelper:GetType("System.Decimal"),"Decimal").
		ultraComboEditorType:Items:Add(Progress.Util.TypeHelper:GetType("System.Int32"),"Whole numer").
		ultraComboEditorType:Items:Add(Progress.Util.TypeHelper:GetType("System.Double"),"Real number").
		ultraComboEditorType:Items:Add(Progress.Util.TypeHelper:GetType("System.DateTime"),"Date").
		
		ultraComboEditorType:Items[0]:ValueList:DisplayStyle = Infragistics.Win.ValueListDisplayStyle:DisplayText.
		ultraComboEditorType:Items[0]:ValueList:SortStyle = Infragistics.Win.ValueListSortStyle:Ascending.
		
		/* Select a default type. */
		if ultraComboEditorType:Items:Count > 0 then
			ultraComboEditorType:SelectedIndex = 0. 
	end method.
       

	/*------------------------------------------------------------------------------
			Purpose:  																	  
			Notes:  																	  
	------------------------------------------------------------------------------*/
	@VisualDesigner.
	METHOD PRIVATE VOID ultraButtonCancel_Click( INPUT sender AS System.Object, INPUT e AS System.EventArgs ):
		
		this-object:DialogResult = System.Windows.Forms.DialogResult:Cancel.

		/*  remove the column if we added one. */
		if valid-object(CreatedColumn) then
			this-object:Band:Columns:Remove( CreatedColumn ).

		delete object CreatedColumn.
		
		RETURN.

	END METHOD.

	/*------------------------------------------------------------------------------
			Purpose:  																	  
			Notes:  																	  
	------------------------------------------------------------------------------*/
	@VisualDesigner.
	METHOD PRIVATE VOID ultraButtonOk_Click( INPUT sender AS System.Object, INPUT e AS System.EventArgs ):
		define variable success as logical no-undo.		
		success = CreateColumnHelper( ).
		if success then
			this-object:DialogResult = System.Windows.Forms.DialogResult:OK.
		
		RETURN.

	END METHOD.

	/*------------------------------------------------------------------------------
			Purpose:  																	  
			Notes:  																	  
	------------------------------------------------------------------------------*/
	@VisualDesigner.
	METHOD PRIVATE VOID ultraTextEditorFormula_EditorButtonClick( INPUT sender AS System.Object, INPUT e AS Infragistics.Win.UltraWinEditors.EditorButtonEventArgs ):
        /*define variable dlg as Infragistics.Win.UltraWinCalcManager.FormulaBuilder.FormulaBuilderDialog no-undo.*/
         		
        CreateColumnHelper().
        
        if not valid-object(CreatedColumn) then
            return.
         
	    /* In order to design a formula, CalcManager property of the grid must
	       be assigned an instance of a calc manager. If none is assigned then
	      create a new one and assign it. */
        if not valid-object(CreatedColumn:Layout:Grid:CalcManager ) then
        	CreatedColumn:Layout:Grid:CalcManager = new Infragistics.Win.UltraWinCalcManager.UltraCalcManager().
         
        /*dlg = new Infragistics.Win.UltraWinCalcManager.FormulaBuilder.FormulaBuilderDialog( CreatedColumn, true ).
        wait-for dlg:ShowDialog( this-object ).     
        if Progress.Util.EnumHelper:AreEqual(dlg:DialogResult,System.Windows.Forms.DialogResult:OK) then
            ultraTextEditorFormula:Text = dlg:Formula.*/
        
        CreatedColumn:Formula = ultraTextEditorFormula:Text.
        	
        RETURN.

	END METHOD.

	/*------------------------------------------------------------------------------
			Purpose:  																	  
			Notes:  																	  
	------------------------------------------------------------------------------*/
	@VisualDesigner.
	METHOD Protected VOID NewColumnDialog_Load( INPUT sender AS System.Object, INPUT e AS System.EventArgs ):
		LoadTypesCombo( ).
		RETURN.
	END METHOD.
 
END CLASS.
